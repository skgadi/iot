<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>IOT configurator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!--Faveicon handling-->
  <link rel="apple-touch-icon" sizes="57x57" href="apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="manifest" href="manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <!--CSS help-->
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-indigo.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css"
    integrity="sha256-46qynGAkLSFpVbEBog43gvNhfrOj+BmwXdxFgVK/Kvc=" crossorigin="anonymous" />
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css" />
  <!--Redirect to a correct page-->

  <style>
    .w3-input {
      outline-width: 0;
    }

    input[type="color"] {
      -webkit-appearance: none;
      border: none;
    }

    input[type="color"]::-webkit-color-swatch-wrapper {
      padding: 0;
    }

    input[type="color"]::-webkit-color-swatch {
      border: none;
    }

    .centerTable>table {
      margin: auto !important;
    }
  </style>
</head>

<body>
  <a class="github-fork-ribbon" href="https://github.com/skgadi/iot" data-ribbon="Code @ GitHub"
    title="Code @ GitHub">Code @ GitHub</a>
  <header class="w3-container w3-theme w3-padding" style="margin-bottom: 20px;">
    <span><img src="android-icon-192x192.png" height="64px;"></span>
    <span class="w3-xlarge">IOT configurator</span>
  </header>
  <div id="app">
    <div v-if="!browserSetup">
      Your browser is not supporting ...
    </div>
    <div v-else>
      <div v-if="!connection">
        Please install the plug-in to proceed ...<br />
        You can download it from <a>here.</a>
      </div>
      <div v-else>
        <input v-model.number="temp">
        <button @click="send">Send</button>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/vue"></script>

  <script>
    var app = new Vue({
      el: "#app",
      data: {
        temp: 0.1,
        browserSetup: false,
        connection: null
      },
      mounted: function () {
        if (window["WebSocket"]) {
          this.browserSetup=true;
        }

      },
      methods: {
        send: function() {
          conn.send("send com3 "+this.temp);
        }
      }
    });

    var conn;
    function checkThePlugin() {
      console.log("called");
      if (!conn) {
        console.log("entered");
        try {
          conn = new WebSocket("ws://localhost:8989/ws");
        } catch (e) {
          return;
        }
        conn.onclose = function (evt) {
          conn = null;
          app.$set(app.$data, 'connection', null);
        }
        conn.onmessage = function (evt) {
          if (!!evt.data && !!JSON.parse(evt.data).Hostname) app.$set(app.$data, 'connection', conn);
          console.log(evt.data);
        }
      }
    }

    checkThePlugin();
    var pluginTestingInterval = setInterval(checkThePlugin, 3000);
  </script>

</body>

</html>